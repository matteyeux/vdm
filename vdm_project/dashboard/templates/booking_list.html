{% extends "layout.html" %}
{% load static %}

{% block title %}
	Liste Booking - {{ block.super }}
{% endblock %}

{% block stylesheets %}
	{{ block.super }}
	<!-- DataTables -->
	<link rel="stylesheet" type="text/css" href="{% static 'plugins/datatables/jquery.dataTables.min.css' %}"/>
	<script src="{% static 'plugins/datatables/jquery.dataTables.min.js' %}"></script>
	<script src="{% static 'plugins/datatables/dataTables.buttons.min.js' %}"></script>
	<script src="{% static 'plugins/datatables/buttons.bootstrap4.min.js' %}"></script>
	<script src="{% static 'plugins/datatables/buttons.html5.min.js' %}"></script>


	<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->
	<script type="text/javascript">    

		// (function($)
		// {
		//     $(document).ready(function()
		//     {
		//         $.ajaxSetup(
		//         {
		//             cache: true,
		//             beforeSend: function() {
		//                 $('#content').show();
		//                 // $('#loading').show();
		//             },
		//             complete: function() {
		//                 $('#content').show();
		//                 // $('#loading').hide();
		//             },
		//             success: function(data) {
		//                 $('#content').show();
		//                 // $('#loading').hide();
		//                 data_json = JSON.parse(data)
		//                 console.log(data_json); 
		//             }
		//         });
		//         var $container = $("#content");
		//         $container.load("http://127.0.0.1:5000/reservations/");
		//         var refreshId = setInterval(function()
		//         {
		//             $container.load("http://127.0.0.1:5000/reservations/");
		//         }, 15000);
		//     });
		// })(jQuery);

	function numberFormatMoney(float) {
		let number = Number.parseFloat(float).toFixed(2);
		let money = number.replace('.', ',');
		return money + " €"; 
	}

	function generateTable(table, data) {
		// console.log(data)
		console.log(data[0]);
		for (let element of data) {
			let row = table.insertRow();
			for (key in element.Acheteur) {
				if (key == "Nom" || key == "Prenom") {
					let cell = row.insertCell();
					let text = document.createTextNode(element.Acheteur[key]);
					cell.appendChild(text);
				}
			}
			let cell = row.insertCell();
			let text = document.createTextNode((element.Reservation).length);
			cell.appendChild(text);

			cell = row.insertCell();
			text = document.createTextNode(element.Game["Nom"]);
			cell.appendChild(text);

			cell = row.insertCell();
			let arrayDate = (element.Game["Jour"]).split('-');
			let date = (arrayDate[2] + "/" + arrayDate[1] + "/" + arrayDate[0]);
			text = document.createTextNode(date);
			cell.appendChild(text);

			let price = 0;
			for (key in element.Reservation) {
				price += element.Reservation[key].prix;
			}
			cell = row.insertCell();
			text = document.createTextNode(numberFormatMoney(price));
			cell.appendChild(text);
		}
	}

	// setInterval(function getData() {
	// 	$.ajax({
	// 		type: "GET",
	// 		url: "http://127.0.0.1:5000/reservations/",
	// 		dataType: "json",
	// 		cache: true,
	// 		success: function(data) {
	// 			let tbody = document.querySelector("tbody");

	// 			while (tbody.firstChild) {
	// 				tbody.removeChild(tbody.firstChild);
	// 			}
	// 			generateTable(tbody, data);
	// 		},
	// 		error: function(xhr, textStatus) {
	// 			console.log("error..");
	// 		}
	// 	});
	// }, 30000);


	// Exemple to load line by line in datatable
	$(document).ready(function() {
	    var t = $('#example').DataTable();
	    var counter = 1;
	 
	    $('#addRow').on( 'click', function () {
	        t.row.add( [
	            counter +'.1',
	            counter +'.2',
	            counter +'.3',
	            counter +'.4',
	            counter +'.5'
	        ] ).draw( false );
	 
	        counter++;
	    } );
	 
	    // Automatically add a first row of data
	    $('#addRow').click();
	} );

	</script>

{% endblock %}

{% block platform_body %}

	{% load custom_filters %}

	<!-- Start content -->
	<div class="content">

		<!-- Start Container -->
		<div class="container-fluid">

			<!-- Start row -->
			<div class="row">
				<div class="col-12">
					<div class="page-title-box">
						<h4 class="page-title">Liste des réservations</h4>
						<ol class="breadcrumb p-0 m-0">
							<li class="breadcrumb-item">
								<a href="#">Plateforme VDM Escape Game</a>
							</li>
							<li class="breadcrumb-item active">
								Liste des réservations
							</li>
						</ol>
						<div class="clearfix"></div>
					</div>
				</div>
			</div>
			<!-- End row -->



<table id="example" class="display" style="width:100%"> 
	<thead> 
		<tr> 
			<th>Column 1</th> 
			<th>Column 2</th> 
			<th>Column 3</th> 
			<th>Column 4</th> 
			<th>Column 5</th> 
		</tr> 
	</thead> 
	<tfoot> 
		<tr> 
			<th>Column 1</th> 
			<th>Column 2</th> 
			<th>Column 3</th> 
			<th>Column 4</th> 
			<th>Column 5</th> 
		</tr> 
	</tfoot> 
</table>

<table cellspacing="0" cellpadding="0" border="0">
	<tbody>
		<tr>
			<td class="gutter">
				<div class="line number1 index0 alt2">1</div>
				<div class="line number2 index1 alt1">2</div>
				<div class="line number3 index2 alt2">3</div>
				<div class="line number4 index3 alt1">4</div>
				<div class="line number5 index4 alt2">5</div>
				<div class="line number6 index5 alt1">6</div>
				<div class="line number7 index6 alt2">7</div>
				<div class="line number8 index7 alt1">8</div>
				<div class="line number9 index8 alt2">9</div>
				<div class="line number10 index9 alt1">10</div>
				<div class="line number11 index10 alt2">11</div>
				<div class="line number12 index11 alt1">12</div>
				<div class="line number13 index12 alt2">13</div>
				<div class="line number14 index13 alt1">14</div>
				<div class="line number15 index14 alt2">15</div>
				<div class="line number16 index15 alt1">16</div>
				<div class="line number17 index16 alt2">17</div>
				<div class="line number18 index17 alt1">18</div>
				<div class="line number19 index18 alt2">19</div>
			</td>
			<td class="code">
				<div class="container">
					<div class="line number1 index0 alt2">
						<code class="js plain">$(document).ready(</code>
						<code class="js keyword">function</code>
						<code class="js plain">() {</code>
					</div><div class="line number2 index1 alt1">
						<code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>
						<code class="js keyword">var</code> 
						<code class="js plain">t = $(</code><code class="js string">'#example'</code><code class="js plain">).DataTable();</code></div><div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code> <code class="js plain">counter = 1;</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">$(</code><code class="js string">'#addRow'</code><code class="js plain">).on( </code><code class="js string">'click'</code><code class="js plain">, </code><code class="js keyword">function</code> <code class="js plain">() {</code></div><div class="line number6 index5 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">t.row.add( [</code></div><div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">counter +</code><code class="js string">'.1'</code><code class="js plain">,</code></div><div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">counter +</code><code class="js string">'.2'</code><code class="js plain">,</code></div><div class="line number9 index8 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">counter +</code><code class="js string">'.3'</code><code class="js plain">,</code></div><div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">counter +</code><code class="js string">'.4'</code><code class="js plain">,</code></div><div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">counter +</code><code class="js string">'.5'</code></div><div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">] ).draw( </code><code class="js keyword">false</code> <code class="js plain">);</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">counter++;</code></div><div class="line number15 index14 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">} );</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">// Automatically add a first row of data</code></div><div class="line number18 index17 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">$(</code><code class="js string">'#addRow'</code><code class="js plain">).click();</code></div><div class="line number19 index18 alt2"><code class="js plain">} );</code></div></div></td></tr></tbody></table><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2" style="display: none;">1</div></td><td class="code"><div class="container" style="display: none;"><div class="line number1 index0 alt2" style="display: none;">&nbsp;</div></div></td></tr></tbody></table>




			<div>
				<!-- Start Row -->
				<div class="row">
					<div class="col-12">
						<div class="page-title-box">
							<h4 class="page-title text-center">Indicateurs de Performance du {% now "d/m/Y" %}</h4>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-xl-2 col-lg-4 col-sm-6">
						<div class="card-box widget-box-two widget-two-primary">
							<div class="wigdet-two-content">
								<p class="m-0 text-uppercase font-600 font-secondary text-overflow" title="CA Cumulé">CA Cumulé</p>
								<h3>89 250</h3>
							</div>
						</div>
					</div>

					<div class="col-xl-2 col-lg-4 col-sm-6">
						<div class="card-box widget-box-two widget-two-warning">
							<div class="wigdet-two-content">
								<p class="m-0 text-uppercase font-600 font-secondary text-overflow" title="Nombre de Réservation">Nb Réservations</p>
								<h3>2975</h3>
							</div>
						</div>
					</div>

					<div class="col-xl-2 col-lg-4 col-sm-6">
						<div class="card-box widget-box-two widget-two-info">
							<div class="wigdet-two-content">
								<p class="m-0 text-uppercase font-600 font-secondary text-overflow" title="Prix de vente moyen d'une réservations">Prix par Réservation</p>
								<h3>30</h3>
							</div>
						</div>
					</div>

					<div class="col-xl-2 col-lg-4 col-sm-6">
						<div class="card-box widget-box-two widget-two-light">
							<div class="wigdet-two-content">
								<p class="m-0 text-uppercase font-600 font-secondary text-overflow" title="Nombre de Spectateurs">Nb de Spectateurs</p>
								<h3>11 900</h3>
							</div>
						</div>
					</div>

					<div class="col-xl-2 col-lg-4 col-sm-6">
						<div class="card-box widget-box-two widget-two-info">
							<div class="wigdet-two-content">
								<p class="m-0 text-uppercase font-600 font-secondary text-overflow" title="Nombre de Spectateurs par Réservations">Spectateurs / Réservations</p>
								<h3>4</h3>
							</div>
						</div>
					</div>

					<div class="col-xl-2 col-lg-4 col-sm-6">
						<div class="card-box widget-box-two widget-two-info">
							<div class="wigdet-two-content">
								<p class="m-0 text-uppercase font-600 font-secondary text-overflow" title="Prix de vente moyen d'un spectateur">Prix par Spectateur</p>
								<h3>7.5 €</h3>
							</div>
						</div>
					</div>
				</div>
				<!-- Row End -->
			</div>

			<!-- Start Row -->
			<div class="row">
				<div class="col-sm-12">
					<div class="card-box">
						<div class="table-rep-plugin">
							<div class="table-responsive mb-0" data-pattern="priority-columns">
								<table id="booking_list" class="display table-bordered table_cluster">
									<thead>
										<tr>
											<th scope="col">Nom</th>
											<th scope="col">Prénom</th>
											<th scope="col">nombre de participants</th>
											<th scope="col">Thème Sélectionné</th>
											<th scope="col">Date de la réservation</th>
											<th scope="col">Montant total réservation</th>
										</tr>
									</thead>
									<tbody>
										{% for booking in bookings %}
											<tr>
												<td>{{ booking.Acheteur.Nom }}</td>
												<td>{{ booking.Acheteur.Prenom }}</td>
												<td>{{ booking.Reservation|length }}</td>
												<td>{{ booking.Game.Nom }}</td>
												<td>{{ booking.Game.Jour|string_to_date:'%Y-%m-%d' }}</td>
												<td>
													{{ booking.total_prix }}
												</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
						</div>

					</div>
				</div>
			</div>
			<!-- Row End -->

		</div> 
		<!-- container-fluid End -->


		<table class="table table-bordered table-condensed" id="tblAccounts"></table>

		<script type="text/template" id="tmpl_Grid">
			<td><%= Id %></td>
			<td><%= Amount %></td>
			<td><%= Date %></td>
			<td><%= Type %></td>
		</script>


	</div> 
	<!-- content End -->

	<!-- Script Jquery / JavaScript -->
	<script>
		var handleDataTableButtons = function() {
				"use strict";
				0 !== $("#booking_list").length && $("#booking_list").DataTable({
					dom: "Bfrtip",
					buttons: [{
						extend: "csv",
						text: "Export csv",
						className: "btn-sm"
					}],
					responsive: !0
				})
			},
			TableManageButtons = function() {
				"use strict";
				return {
					init: function() {
						handleDataTableButtons()
					}
				}
			}();

		TableManageButtons.init();
	</script>

{% endblock %}